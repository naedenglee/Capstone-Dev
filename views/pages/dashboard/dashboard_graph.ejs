<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="/assets/graph.css">
       <!-- Material Icons -->
       <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
       <script src="https://cdn.anychart.com/js/8.0.1/anychart-core.min.js"></script>
       <script src="https://cdn.anychart.com/js/8.0.1/anychart-pie.min.js"></script>
       
    <title>Dashboard</title>
  </head>
<body>
	<%- include ('dashboard_sidebar') -%>
    
	<section id="content">
		<nav>
			<i class='bx bx-menu toggle-sidebar' ></i>
			<form action="#">
				<div class="form-group">
				</div>
			</form>
			
      <div class="profile" style="margin-right: 20px;" onclick="newfunc()" >
				<img src="/images/system_images/bell_icon.png" alt="">
        <% if (notif_result == 0) { %>
        <span id="notifCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
				<ul class="profile-link" >          
            <p style="margin-top: 30px; margin-bottom: 30px; text-align: center;">No new notifications.</p>
          <% } else if(notif_result){ %>
            <span id="notifCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
               New!</span>
            <ul class="profile-link" style="max-height: 500px; overflow:scroll;">       
            <% notif_result.forEach(function(notif){ %>
              <% if(notif.reserve_status == 10 && notif.owner_id == user_id){ %>
                <div class="row">
                  <li><a href="#">
                  <div class="col" style="width: 10px;">
                    <!-- <%= notif.notification_date.toISOString().split('T')[0] %> -->
                    <%= notif.notification_date.toDateString() %>
                  </div>
                  <div class="col">
                    The item for Rental ID Number <%= notif.reservation_id%> has been received by the client through courier.
                    <a href="/rental/view/delivery/<%= notif.reservation_id%>">View Delivery Confirmation</a>
                   <input type="hidden" id="notif_type" value="<%=notif.notification_type %>">
                   <input type="hidden" id="notif_value" value="The item for Rental ID Number <%= notif.reservation_id%> has been received by the client through courier.">
                  </div></a></li>       
                </div>
                <hr class="hr" />
              <% }else if(notif.reserve_status == 2 && notif.owner_id == user_id){ %>
                <div class="row">
                  <li><a href="#">
                  <div class="col" style="width: 10px;">
                    <!-- <%= notif.notification_date.toISOString().split('T')[0] %> -->
                    <%= notif.notification_date.toDateString() %>
                  </div>
                  <div class="col">
                    The client for Rental ID Number <%= notif.reservation_id%> has accepted the item and the transaction will proceed.
                    <a href="/rental/view/delivery/<%= notif.reservation_id%>">View Delivery Confirmation</a>
                   <input type="hidden" id="notif_type" value="<%=notif.notification_type %>">
                   <input type="hidden" id="notif_value" value=" The client for Rental ID Number <%= notif.reservation_id%> has accepted the item and the transaction will proceed.">
                  </div></a></li>       
                </div>
                <hr class="hr" />      
                <% }else if(notif.reserve_status == 7 && notif.owner_id == user_id) { %>
                  <div class="row">
                    <li><a href="#">
                    <div class="col" style="width: 10px;">
                      <!-- <%= notif.notification_date.toISOString().split('T')[0] %> -->
                      <%= notif.notification_date.toDateString() %>
                    </div>
                    <div class="col">
                      The client for Rental ID Number <%= notif.reservation_id%> has rejected the item. The transaction is cancelled.
                      <a href="/rental/view/delivery/<%= notif.reservation_id%>">View Delivery Confirmation</a>
                     <input type="hidden" id="notif_type" value="<%=notif.notification_type %>">
                     <input type="hidden" id="notif_value" value="The client for Rental ID Number <%= notif.reservation_id%> has rejected the item. The transaction is cancelled.">
                    </div></a></li>       
                  </div>
                  <hr class="hr" />                          
                <% }else if(notif.reserve_status == 3 && notif.owner_id == user_id){ %>
                <div class="row">
                  <li><a href="#">
                  <div class="col" style="width: 10px;">
                    <!-- <%= notif.notification_date.toISOString().split('T')[0] %> -->
                    <%= notif.notification_date.toDateString() %>
                  </div>
                  <div class="col">
                    The client has sent the item out for delivery.
                   <input type="hidden" id="notif_type" value="<%=notif.notification_type %>">
                   <input type="hidden" id="notif_value" value="The client has sent the item out for delivery.">
                  </div></a></li>       
                </div>
                <hr class="hr" />
              <% }else if(notif.reserve_status == 4 && notif.client_id == user_id){ %>
                <div class="row">
                  <li><a href="#">
                  <div class="col" style="width: 10px;">
                    <!-- <%= notif.notification_date.toISOString().split('T')[0] %> -->
                    <%= notif.notification_date.toDateString() %>
                  </div>
                  <div class="col">
                    The owner of the item for Rental ID Number <%= notif.reservation_id %> has received the item through courier.
                   <input type="hidden" id="notif_type" value="<%=notif.notification_type %>">
                   <input type="hidden" id="notif_value" value="The owner of the item for Rental ID Number <%= notif.reservation_id %> has received the item through courier.">
                  </div></a></li>       
                </div>
                <hr class="hr" />
              <% }else if(notif.reserve_status == 5 && notif.client_id == user_id){ %>
                <div class="row">
                  <li><a href="#">
                  <div class="col" style="width: 10px;">
                    <!-- <%= notif.notification_date.toISOString().split('T')[0] %> -->
                    <%= notif.notification_date.toDateString() %>
                  </div>
                  <div class="col">
                    The rental (Rental ID Number <%=notif.reservation_id %>) is successful!
                   <input type="hidden" id="notif_type" value="<%=notif.notification_type %>">
                   <input type="hidden" id="notif_value" value="The rental (Rental ID Number <%=notif.reservation_id %>) is successful!">
                  </div></a></li>       
                </div>
                <hr class="hr" />
              <% }else if(notif.notification_type == 1 && notif.owner_id == user_id){ %>
                <div class="row">
                  <li><a href="#">
                  <div class="col" style="width: 10px;">
                    <!-- <%= notif.notification_date.toISOString().split('T')[0] %> -->
                    <%= notif.notification_date.toDateString() %>
                  </div>
                  <div class="col">
                    <%=notif.client_username %> has added your item: <%=notif.item_name %> to their wishlist.
                   <input type="hidden" id="notif_type" value="<%=notif.notification_type %>">
                   <input type="hidden" id="notif_value" value="The client has sent the item out for delivery.">
                  </div></a></li>       
                </div>
                <hr class="hr" />
              <% }else if(notif.notification_type == 2 && notif.client_id == user_id){ %>
                <div class="row">
                  <li><a href="#">
                  <div class="col" style="width: 10px;">
                    <!-- <%= notif.notification_date.toISOString().split('T')[0] %> -->
                    <%= notif.notification_date.toDateString() %>
                  </div>
                  <div class="col">
                   Your rental request for Rental ID Number <%= notif.reservation_id %> has been approved by the owner.
                   <input type="hidden" id="notif_type" value="<%=notif.notification_type %>">
                   <input type="hidden" id="notif_value" value="The client has sent the item out for delivery.">
                  </div></a></li>       
                </div>
                <hr class="hr" />
              <% }else if(notif.notification_type == 3 && notif.client_id == user_id){ %>
                <div class="row">
                  <li><a href="#">
                  <div class="col" style="width: 10px;">
                    <!-- <%= notif.notification_date.toISOString().split('T')[0] %> -->
                    <%= notif.notification_date.toDateString() %>
                  </div>
                  <div class="col">
                   Your rental request for Rental ID Number <%= notif.reservation_id %> has been denied by the owner.
                   <input type="hidden" id="notif_type" value="<%=notif.notification_type %>">
                   <input type="hidden" id="notif_value" value="The client has sent the item out for delivery.">
                  </div></a></li>       
                </div>
                <hr class="hr" />
              <% } %>              
            <% }) %> 
          <% } %>

			</div>
		</nav>
		<div class="dash-content">
            <div class="overview">
		<!-- Main -->
        <main class="main-container">
            <div class="main-title">
              <p class="font-weight-bold">DASHBOARD</p>
            </div>

            <div id="liveAlertPlaceholder" style="text-align: center; margin-top: 3px;"></div>
            
            <div class="main-cards">
    
              <a href="/seller/items">
              <div class="card">
                <div class="card-inner">
                  <p class="text-primary">PRODUCTS</p>
                  <span class="material-icons-outlined text-blue">inventory_2</span>
                </div>
                <span class="text-primary font-weight-bold"><%= summary[0].products %></span>
              </div>
                </a> 
              <a href="/dashboard/lessor/requests">
              <div class="card">
                <div class="card-inner">
                  <p class="text-primary">RENTAL REQUESTS</p>
                  <span class="material-icons-outlined text-orange">add_shopping_cart</span>
                </div>
                <span class="text-primary font-weight-bold"><%= summary[0].purchase_orders %></span>
              </div>
              </a> 
    
              <a href="/dashboard/lessor/rentals/ongoing">
              <div class="card">
                <div class="card-inner">
                  <p class="text-primary">ONGOING RENTALS</p>
                  <span class="material-icons-outlined text-green">shopping_cart</span>
                </div>
                <span class="text-primary font-weight-bold"><%= summary[0].sales_orders %></span>
              </div>
              </a> 

              <a href="/dashboard/lessor/rentals/finished">
              <div class="card">
                <div class="card-inner">
                  <p class="text-primary">LIFETIME SALES</p>
                  <span class="material-icons-outlined text-red">notification_important</span>
                </div>
                <span class="text-primary font-weight-bold">â‚±<%= summary[0].lifetime_sales.toFixed(2) %></span>
              </div>
              </a> 
    
            </div>
    
            <div class="charts">
    
              <div class="charts-card">
                <p class="chart-title">Most Searched Terms</p>
                <div id="bar-chart"></div>
              </div>
    
              <div class="charts-card">
                <p class="chart-title">Wishlist and Reservation Orders</p>
                <div id="area-chart"></div>
              </div>
    
            </div>

            <div class="charts">
    
                <div class="charts-card">
                  <p class="chart-title">Top 3 Best Sellers</p>
                  <div id="bar-chart2"></div>
                </div>
      
                <div class="charts-card">
                    <p class="chart-title">Top 3 Most Viewed Product</p>
                    <div id="bar-chart3"></div>

                  </div>
              </div>
            
        </div>

          </main>
          <!-- End Main -->
    
        </div>

        <section style="height: 800px;">
           
          
                  </div>
            </div>
          </section>
          

         
    
        <!-- Scripts -->
        <!-- ApexCharts -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.35.3/apexcharts.min.js"></script>
        <!-- Custom JS -->
				
	</section>
    <script id="scriptValue" data-stats="<%= JSON.stringify(result) %>"  src="/assets/scripts/graph.js"></script>
</body>

  <script>
  async function getStatus(){   
    var status = '<%=status%>'
    if(status == 'updateSuccess'){
      const alertPlaceholder = document.getElementById('liveAlertPlaceholder')    
      const wrapper = document.createElement('div')
      wrapper.innerHTML = [
        `<div class="alert alert-success alert-dismissible" role="alert">`,
        `   <div>Rental Status Updated Successfully</div>`,
        '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
        '</div>'
      ].join('')
      alertPlaceholder.append(wrapper)   
    }
  }
  
  getStatus()

    async function newfunc(){
    spanText = document.getElementById("notifCount")
    spanText.textContent = ''
  }
  async function showNotifAlert(){   
    var colValue = document.getElementById('notif_type')
    var rowValue = document.getElementById('notif_value')
    var notif_type = colValue.value
    var notif_value = rowValue.value
    console.log(notif_type)
    console.log(notif_value)
   
      
      const alertPlaceholder = document.getElementById('liveAlertPlaceholder')    
      const wrapper = document.createElement('div')
      wrapper.innerHTML = [
        `<div class="alert alert-success alert-dismissible" role="alert">`,
        `   <div>Latest Notification: ${notif_value}</div>`,
        '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
        '</div>'
      ].join('')
      alertPlaceholder.append(wrapper)   
    
    
  }
  
  showNotifAlert()
  </script>

</html>
