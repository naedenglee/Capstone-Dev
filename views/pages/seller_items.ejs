<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<link rel="stylesheet" href="/assets/dashboard_orders.css">
	<title>Your Items</title>
</head>
<style>
    input[type=text], input[type=password], input[type=number] {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  box-sizing: border-box;
}
</style>
<body>
	<!-- SIDEBAR -->
    <%- include ('navbar') -%>
      <div class="title" style="margin-top: 90px; margin-left: 30px;">
			<h1 class="title">Your Listed Items</h1>
      <div id="liveAlertPlaceholder" style="text-align: center;"></div>
			</div>

		<div class="boxes"  style="overflow-x:auto; margin-right: 30px; margin-left: 30px;">
            <table class="table table-bordered">
                
            <% if(sellerItemsResult == 0) { %>
                <center style="margin-top: 40px;"><p>You don't have any listed items at the moment. <br><a href="/">Go back?</a></p></center>
            <% }else if(sellerItemsResult){ %>
                <thead>
                    <tr>
                    <th scope="col">Item ID</th>
                    <th scope="col">Item Name</th>
                    <th scope="col">Category</th>
                    <th scope="col">Description</th>
                    <th scope="col">Rental Rate</th>
                    <th scope="col">Replacement Cost</th>   
                    <th scope="col">Inventory Quantity</th>               
                    <th scope="col">Action (Edit)</th>
                    </tr>
                </thead>
                <tbody>

                <% sellerItemsResult.forEach(function(item){ %>
                    <tr>
                        <td id="id"><%=item.item_id %></td>
                        <td id="itemName"><%=item.item_name %></td>
                        <td id="category"><%=item.item_category %></td>
                        <td id="description" style="max-width: 400px"><%=item.item_description %></td>
                        <td id="rentalRate"><%=item.rental_rate %></td>
                        <td id="deposit"><%=item.replacement_cost %></td>
                        <td id="quantity"><%=item.item_quantity %></td>                      
                        <td id="action"><div class="p-1">
                            
                        <button class="btn btn-primary button-1" data-bs-toggle="modal" name="rental_button" data-bs-target="#finishTransactionModal" id="buttonVal" value="4" data-id="2" 
                        onclick="updateBtnFunc(<%=item.item_id %>, '<%=item.item_name %>', <%=item.item_quantity %>, '<%=item.item_category %>', <%=item.rental_rate %>, <%=item.replacement_cost %>, <%=item.item_quantity %>, '<%=item.item_description %>')" 
                        data-id="1">Edit Item Details</button><br>
                                                    
                        <p id="status" class="py-1"></p>
                        </div></td>                        
                        </tr>
                <% }) %>                       
            <% } %>   

                </tbody>
              </table>
		</div>
	</section>

  
  <!-- FINISHING OF TRANSACTION MODAL -->
  <form action="/seller/update/item" method="post">
    <div class="modal fade" id="finishTransactionModal" tabindex="-1" aria-labelledby="finishTransactionModalLabel" aria-hidden="true" >
      <div class="modal-dialog" >
        <div class="modal-content">
          <div class="modal-header">
            
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="container2">
                <h1>Edit Item</h1>
                <p>Note: Changes made here will reflect immediately</p>
                <hr>
          
                <div class="row">
                          <div class="col">
                              <div class="form-group my-2">
                                  <label for="itemName">Item Name</label>
                                  <input type="text" class="form-control" id="itemNameModal" name="itemName" value="" required>		
                              </div>
                          </div>
                          <div class="col">
                              <div class="form-group my-2">
                                  <label for="quantity">Set Quantity</label>
                                  <input type="number" class="form-control" id="quantityModal" name="quantity" min="0" value="" required>
                              </div>
                          </div>					
                      </div>
                      
                      <div class="row">
                          <div class="col">
                              <div class="form-group my-2">
                                  <label for="category">Category</label>
                                  <select class="form-select form-select-lg" name="categoryModal" style="font-size:medium; margin-top: 10px;">
                                    <option>Gowns & Suits</option>
                                    <option>Musical Instrument</option>
                                    <option>Tools</option>
                                    <option>Books</option>
                                    <option>Entertainment</option>
                                    <option>Film/Photography</option>
                                    <option>Drones</option>
                                    <option>Projectors</option>
                                    <option>Costumes</option>
                                    <option>Camping Tents</option>
                                    <option>Furnitures</option>
                                </select>	
                              </div>
                          </div>                          
                       	
                      </div>
                <div class="row">
                    <div class="col">
                        <div class="form-group my-2">
                            <label for="rentalRate" style="margin-top: 22px;">Rental Rate (in Peso)</label>
                            <input type="number" class="form-control" id="rentalRateModal" name="rentalRate" min="1" value="" required>		
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group my-2">
                            <label for="deposit">Replacement Cost(Deposit)</label>
                            <input type="number" class="form-control" id="depositModal" name="deposit" min="1" value="" required>
                        </div>
                    </div>                         	
                      </div>
                      <div class="row">
                        <div class="col">
                            <div class="form-group my-2">
                                <label for="description">Item Description</label>
                                <textarea class="form-control" id="descriptionModal" name="descriptionModal" rows="4"></textarea>	
                            </div>
                            <input type="hidden" id="itemIdModal" name="itemId" value="">
                        </div>                                               	
                          </div>
                      <br>                      
                      </div>
          
          
                
                <label>
                  <input type="checkbox"  name="remember" style="margin-bottom:15px" required> All inputs above are correct.
                </label>
                <br>
                <button type="submit" class="btn btn-primary">Save Changes</button>
               
          
               
              </div>
          </div>
          
        </div>
      </div>
    </div>      
  </form>


	<script src="/assets/scripts/dashboard_orders.js"></script>
</body>

<script>

  function updateBtnFunc(id, name, qty, categ, rate, replacement, qty, desc){
    modalItemName = document.getElementById("itemNameModal")
    modalItemName.setAttribute("value", name)

    modalItemQty = document.getElementById("quantityModal")
    modalItemQty.setAttribute("value", qty)    

    modalRate = document.getElementById("rentalRateModal")
    modalRate.setAttribute("value", rate)

    modalDeposit = document.getElementById("depositModal")
    modalDeposit.setAttribute("value", replacement)

    modalId = document.getElementById("itemIdModal")
    modalId.setAttribute("value", id)

    modalDescription = document.getElementById("descriptionModal")
    modalDescription.value = desc

    }

    async function getStatus(){   
    var status = '<%=status%>'

    if(status == 'editSuccess'){
      const alertPlaceholder = document.getElementById('liveAlertPlaceholder')    
      const wrapper = document.createElement('div')
      wrapper.innerHTML = [
        `<div class="alert alert-success alert-dismissible" role="alert">`,
        `   <div>Item Updated!</div>`,
        '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
        '</div>'
      ].join('')

      alertPlaceholder.append(wrapper)   
    }
  }
  
  getStatus()
</script>

</html>
