<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- favicon -->
<link rel="shortcut icon" href="img/favlogo.ico" type="image/x-icon">
<link rel="icon" href="img/favlogo.ico" type="image/x-icon">

    <title>Mang Hiram</title>
   <link rel="stylesheet" href="/assets/user-profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- for latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

  <!-- for leflet.js (map)-->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
crossorigin=""></script>


<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body style="background-color: #eee;">
    <!-- Navigation -->
    <%- include ('navbar') -%>

    <section style="background-color: #eee; margin-top: 80px;">
        <div class="container py-5">
      
          <div class="row">
            <div class="col-lg-4">
              <div class="card mb-4">
                <div class="card-body text-center">
                  <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava3.webp" alt="avatar"
                    class="rounded-circle img-fluid" style="width: 150px;">
                  <h5 class="my-3"><%= result[0].username  %> </h5>
                  <p class="text-muted mb-1">
                    <% if(userRatingResult[0].rate_count == 0){ %>
                      No Reviews
                    <% } else { %>
                      <%= userRatingResult[0].average_rating %> <i class="fa-solid fa-star" style="color: orange;"></i>
                    <% } %>
                    </p>
                  <p class="text-muted mb-4">Sta. Mesa, Manila</p>
                  <div class="d-flex justify-content-center mb-2">
                    <% if(profile_id != user_id){ %>
                      <a href="#"><button type="button" class="btn btn-outline-primary ms-1">Message</button></a>
                    <% } else if(profile_id == user_id){ %>
                      <button type="button" class="btn btn-primary" data-bs-toggle="modal" value="1" data-bs-target="#finishTransactionModal">Edit Profile</button>
                    <% } %>
                    
                    
                  </div>
                </div>
              </div>
              
            </div>
            <div class="col-lg-8">
              <div class="card mb-4">
                <div class="card-body">
                
                  <div class="row">
                    <div class="col-sm-3">
                      <p class="mb-0">Email</p>
                    </div>
                    <div class="col-sm-9">
                      <p class="text-muted mb-0"><%= profile[0].email %>
                        <% if(profile_id == user_id){ %>
                          <button type="button" class="btn btn-primary"  data-bs-toggle="modal" value="2" data-bs-target="#finishTransactionModal2" style="float: right;">Edit Email</button></p>

                        <% } %>
                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-3">
                      <p class="mb-0">Phone</p>
                    </div>
                    <div class="col-sm-9">
                      <p class="text-muted mb-0"><%= profile[0].phone_num %></p>
                    </div>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col-sm-3">
                      <p class="mb-0">Mobile</p>
                    </div>
                    <div class="col-sm-9">
                      <p class="text-muted mb-0">(098) 765-4321</p>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-8">
                  <div class="card mb-4 mb-md-0">
                    <div class="card-body">
                      <p class="mb-4"><b>ABOUT</b></i>
                      </p>
                      <% if(profile[0].about == null){ %>
                        <p> No about info</p>
                      <% }else if(profile[0].about){ %>
                        <p> <%= profile[0].about %></p>
                      <% } %>
                     
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                    <div class="card mb-4 mb-md-0">
                      <div class="card-body" style="height: 120px;">
                        <% if(userRatingResult[0].rate_count == 0){ %>
                          No Reviews
                        <% } else { %>
                          <center style="margin-top: 25px;">
                            <p class="mb-4"><span class="text-primary font-italic me-1"><%= userRatingResult[0].rate_count %> Reviews</span> <%= userRatingResult[0].average_rating %> <i class="fa-solid fa-star" style="color: orange;"></i>
                          </center>
                          </p>                         
                        <% } %>
                        
                        
                      </div>
                    </div>
                  </div>
              </div>

              <div class="card mb-4" style="margin-top: 20px; ">
                <div class="card-body">
                  <% if(profile_id == user_id){ %>
                    <% if(profile[0].map_x_coordinate == null || profile[0].map_y_coordinate == null){ %>
                      <center><p style="font-weight: bold;">INTERACTIVE MAP</p></center>
                      <center>
                        <p data-toggle="modal" data-target="#myModal">Insert location coordinates to display an interactive map here.</p>
                        <button type="button" class="btn btn-primary"  data-bs-toggle="modal" value="2" data-bs-target="#finishTransactionModal">Insert</button></p>

                      </center>
                    <% } else{ %>
                      <center><p style="font-weight: bold;">INTERACTIVE MAP</p></center>
                      <div id="map" style="height: 250px;"></div>
                    <% } %>
                  <% }else if(profile_id != user_id){ %>
                    <% if(profile[0].map_x_coordinate == null || profile[0].map_y_coordinate == null){ %>
                      <center><p style="font-weight: bold;">INTERACTIVE MAP</p></center>
                      <center><p>No map information available for this user.</p></center>
                    <% } else{ %>
                      <center><p style="font-weight: bold;">INTERACTIVE MAP</p></center>
                      <div id="map" style="height: 250px;"></div>
                    <% } %>
                  <% } %>

                  
                  
                </div>
              </div>
        
            </div>
          </div>
          <div class="categories" style="margin-top: 20px;">
                <!-- Products-->
                <% if(itemRows == 0){ %>
                  <center><h6>This user has no items for sale.</h6></center>
                <% }else if(itemRows) { %>
                  <div class="row">
                  <% itemRows.forEach(function(item){ %>
                    
                      <div class="col-12 col-sm-6 col-lg-3">
                        <div class="card shadow">
                          <div>
                              <a href="/item/view/<%= item.item_id %>">
                                <img src="<%= item.image_path %>" alt="Image1" class="img-fluid card-img-top" style="height: 250px">
                               </a>
                            </div>
                          <div class="card-body">
                            <h5 class="card-title"><%= item.item_name %><p class="text-primary">₱<%= item.rental_rate %>/day</p></h5>  
                            <p class="text-muted mb-1">Click to View Item</p>                                                          
                          </div>
                        </div>
                      </div>                  
                      
                  <% }) %>
                </div>
                <% } %>
              </div>
                </div>
                </div>
          </div>
          


        </div>
      </section>

      <form action="/profile/update" method="post">
        <div class="modal fade" id="finishTransactionModal" tabindex="-1" aria-labelledby="finishTransactionModalLabel" aria-hidden="true" >
          <div class="modal-dialog" >
            <div class="modal-content">
              <div class="modal-header">
                
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="container2">
                    <h1>Edit Profile</h1>
                    <p>Note: Changes made here will reflect immediately</p>
                    <hr>
              
                    <div class="row">
                              <div class="col">
                                  <div class="form-group my-2">
                                      <label for="phoneNum">Mobile Number</label>
                                      <input type="text" class="form-control" id="phoneNumModal" name="phoneNum" value="<%= profile[0].phone_num %>" required>		
                                  </div>
                              </div>                              				
                          </div>
                          
                          <div class="row">
                              <div class="col">
                                  <div class="form-group my-2">
                                    <label for="aboutModal">About Info</label>
                                    <textarea class="form-control" id="aboutModal" name="about" rows="4"><%= profile[0].about %></textarea>	
                                  </div>
                              </div>                          
                             
                          </div>

                          <div class="row">
                            <p>Location (for interactive map)</p>
                            <div class="col">
                                <div class="form-group my-2">
                                  <label for="mapx">X-Coordinate</label>
                                  <input class="form-control" type="number" step="any" id="mapx" name="map_x" value="<%= profile[0].map_x_coordinate %>">
                                </div>
                            </div> 
                            <div class="col">
                              <div class="form-group my-2">
                                <label for="mapy">Y-Coordinate</label>
                                <input class="form-control" type="number" step="any" id="mapy" name="map_y" value="<%= profile[0].map_y_coordinate %>">
                              </div>
                          </div>                            
                          </div>
                    
                          <br>                      
                          </div>
              
              
                    
                    <label>
                      <input type="checkbox"  name="remember" style="margin-bottom:15px" required> All inputs above are correct.
                    </label>
                    <br>
                    <button type="submit" name="profileButton" value="1" class="btn btn-primary">Save Changes</button>
                   
              
                   
                  </div>
              </div>
              
            </div>
          </div>
        </div>      
      </form>


      <!-- MODAL 2 FOR EMAIL -->
      <form action="/profile/update" method="post">
        <div class="modal fade" id="finishTransactionModal2" tabindex="-1" aria-labelledby="finishTransactionModalLabel2" aria-hidden="true" >
          <div class="modal-dialog" >
            <div class="modal-content">
              <div class="modal-header">
                
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="container2">
                    <h1>Edit E-Mail Address</h1>
                    <p>Note: Changes made here will reflect immediately. Changes in your email address will result in requiring you to verify again when listing new items.</p>
                    <hr>
              
                    <div class="row">
                              <div class="col">
                                  <div class="form-group my-2">
                                      <label for="emailModal">E-mail Address</label>
                                      <input type="email" class="form-control" id="emailModal" name="email" value="<%= profile[0].email %>" required>		
                                  </div>
                              </div>                              				
                          </div>                    
                          
                    
                          <br>                      
                          </div>
              
              
                    
                    <label>
                      <input type="checkbox"  name="remember" style="margin-bottom:15px" required> All inputs above are correct.
                    </label>
                    <br>
                    <button type="submit" name="profileButton" value="2" class="btn btn-primary">Save Changes</button>
                   
              
                   
                  </div>
              </div>
              
            </div>
          </div>
        </div>      
      </form>

      <!-- Footer -->
<footer class="text-center text-lg-start bg-light text-muted" style="margin-top: 27px;">
    <!-- Section: Social media -->
    <section class="d-flex justify-content-center justify-content-lg-between p-4 border-bottom">
      <!-- Left -->
      <div class="me-5 d-none d-lg-block">
        <span>Get connected with us on social networks:</span>
      </div>
      <!-- Left -->
  
      <!-- Right -->
      <div>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-twitter"></i>
        </a>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-google"></i>
        </a>
        <a href="" class="me-4 text-reset">
          <i class="fab fa-instagram"></i>
        </a>
      </div>
      <!-- Right -->
    </section>
    <!-- Section: Social media -->
  
    <!-- Section: Links  -->
    <section class="">
      <div class="container text-center text-md-start mt-5">
        <!-- Grid row -->
        <div class="row mt-3">
          <!-- Grid column -->
          <div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4">
            <!-- Content -->
            <h6 class="text-uppercase fw-bold mb-4">
              <i class="fas fa-gem me-3"></i>Mang Hiram
            </h6>
            <p>
              Our technology encourages people to share and brings local communities together. We'd love for you to join us, whether you're looking for a low-cost way to rent what you need locally, or you're a business or individual looking to make money from items you own that are sitting idle.
            </p>
          </div>
          <!-- Grid column -->
  
          <!-- Grid column -->
          <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
            <!-- Links -->
            <h6 class="text-uppercase fw-bold mb-4">
              Products
            </h6>
            <p>
              <a href="#!" class="text-reset"></a>
            </p>
            <p>
              <a href="#!" class="text-reset"></a>
            </p>
            <p>
              <a href="#!" class="text-reset"></a>
            </p>
            <p>
              <a href="#!" class="text-reset"></a>
            </p>
          </div>
          <!-- Grid column -->
  
          <!-- Grid column -->
          <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mb-4">
            <!-- Links -->
            <h6 class="text-uppercase fw-bold mb-4">
              Useful links
            </h6>
            <p>
              <a href="#!" class="text-reset">Pricing</a>
            </p>
            <p>
              <a href="#!" class="text-reset">Settings</a>
            </p>
            <p>
              <a href="#!" class="text-reset">Orders</a>
            </p>
            <p>
              <a href="#!" class="text-reset">Help</a>
            </p>
          </div>
          <!-- Grid column -->
  
          <!-- Grid column -->
          <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
            <!-- Links -->
            <h6 class="text-uppercase fw-bold mb-4">Contact</h6>
            <p><i class="fas fa-home me-3"></i> Manila City, Philippines</p>
            <p>
              <i class="fas fa-envelope me-3"></i>
              manghiram@gmail.com
            </p>
            <p><i class="fas fa-phone me-3"></i> + 01 234 567 88</p>
            <p><i class="fas fa-print me-3"></i> + 01 234 567 89</p>
          </div>
          <!-- Grid column -->
        </div>
        <!-- Grid row -->
      </div>
    </section>
    <!-- Section: Links  -->
  
    <!-- Copyright -->
    <div class="text-center p-4" style="background-color: rgba(0, 0, 0, 0.05);">
      © 2021 Copyright:
      <a class="text-reset fw-bold" href="#">MangHiram.com</a>
    </div>
    <!-- Copyright -->
  </footer>
  <!-- Footer -->
</body>

<script>
  x_coord = <%= profile[0].map_x_coordinate %>;
  y_coord = <%= profile[0].map_y_coordinate %>;
  var map = L.map('map').setView([x_coord, y_coord], 17);
       L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
       maxZoom: 19,
       attribution: '© OpenStreetMap'
      }).addTo(map);
      var marker = L.marker([x_coord, y_coord]).addTo(map);

  
</script>
</html>