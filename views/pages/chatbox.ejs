<!DOCTYPE html>
<html lang="en">
<head>
  <!-- favicon -->
<link rel="shortcut icon" href="img/favlogo.ico" type="image/x-icon">
<link rel="icon" href="img/favlogo.ico" type="image/x-icon">

    <title>Mang Hiram</title>
   <link rel="stylesheet" href="/assets/chatbox.css">

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  
</head>
<body>
  <%- include ('navbar') -%>
    <div class="container" style="margin-top: 100px;">
        <h3 class=" text-center">Messaging</h3>
        <div class="messaging">
              <div class="inbox_msg">
                <div class="inbox_people">
                  <div class="headind_srch">
                    <div class="recent_heading">
                      <h4>Recent</h4>
                    </div>
                    <div class="srch_bar">
                      <div class="stylish-input-group">
                        <input type="text" class="search-bar"  placeholder="Search" >
                        <span class="input-group-addon">
                        <button type="button"> <i class="fa fa-search" aria-hidden="true"></i> </button>
                        </span> </div>
                    </div>
                  </div>
                  <div class="inbox_chat">
                    
                    <% allChat.forEach(function(members){ %>
                    <div class="chat_list">
                        <a href="/chat/show/<%=members.chat_id%>/<%=members.room%>">
                      <div class="chat_people">
                        <div class="chat_img"> <img src="/images/system_images/profile-icon.png"> </div>
                        <div class="chat_ib">
                            <h5 style="margin-top: 15px"><%=members.name %> <span class="chat_date"></span></h5>
                        </div>
                      </div>
                    </a>
                    </div>
                    <% }) %>
                </div>
                </div>
                <div class="mesgs">
                <div class="msg_name">
                                    <h4 style="margin-top: -15px;"><%= chatName %></h4>
                                    <hr>
                                  </div>
                  <div class="msg_history" id = "msg_history">                    
                  <% messages.forEach(function(message){ %>
                      <% if(user_id == message.sender){ %>
                        <div class="outgoing_msg">
                          <div class="sent_msg">
                              <p><%=message.chatMessage %></p>
                            <% if(message.image !=null || message.image == ''){ %>
                              <a href= "<%=message.image%>"><img src = "<%=message.image%>"></a>
                            <% } %>
                              <span class="time_date"> <%=message.time%></span> </div>
                        </div>
                      <% }else if(user_id == message.receiver){ %>
                        <div class="incoming_msg">
                          <div class="incoming_msg_img"><a href="#"><img src="img/profile-icon.png"></a></div>
                          <div class="received_msg">
                            <div class="received_withd_msg">
                              <p><%=message.chatMessage %></p>
                            <% if(message.image !=null || message.image == ''){ %>
                              <a href= "<%=message.image%>"><img src = "<%=message.image%>"></a>
                            <% } %>
                              <span class="time_date"> <%=message.time%></span> </div>
                          </div>
                        </div>
                      <% } %>
                    <% }) %>
                  </div>
                  <form method="post" action= "/chat/show/<%=chat_id%>/<%=room_id%>">
                  <div class="type_msg">
                    <div class="input_msg_write">
                      <input type="text" class="write_msg" name="input" placeholder="Type a message" />
                      <button class="msg_send_btn" type="submit">Send</button>
                    </div>
                    </form> 
                      
                    <!--<a href="#" class="float">
                        <i class="fa fa-plus my-float"></i>
                        </a> -->
                            <label for="apply"><input type="file" name="imageFile" id="apply" accept="image/*,.pdf"><i class="fa fa-plus my-float"></i></label>
                            <input type="hidden" id="imageFileb64" name="imageFileb64">
                  </div>
                </div>
              </div>
            </div></div>
            <script src="/assets/scripts/itemlist-forms.js"></script>
</body>

<script>
    nestedElement = document.getElementById("msg_history");
    nestedElement.scrollTo(0, nestedElement.scrollHeight);
    function readFile() { 
      if (!this.files || !this.files[0]) return;         
      const FR = new FileReader();
         
      FR.addEventListener("load", function(evt) {
         document.querySelector("#imageFileb64").value = evt.target.result;
      });          
      FR.readAsDataURL(this.files[0]);      
      }

      document.querySelector("#apply").addEventListener("change", readFile);
</script>

</html>
