app.post("/item/listing", async(req,res) => {   
    //cloudinary upload function 
    const uploadImage = async (imagePath) => {

        // Use the uploaded file's name as the asset's public ID and 
        // allow overwriting the asset with new versions
        const options = {
            use_filename: true,
            unique_filename: false,
            overwrite: true,
            folder:'mang-hiram-seller-pictures'
        };
    
        try {
            // Upload the image
            const result = await cloudinary.uploader.upload(imagePath, options);
            console.log(result);
            return result.secure_url;
        } catch (error) {
            console.error(error);
        }
    };

    const imagePath = req.body.imageFileb64;

    // Upload the image
    const imageUrl = await uploadImage(imagePath);
    console.log(imageUrl)

    var sqlQuery = { 
        text: `CALL item_insert($1, $2, $3, $4, $5, $6, $7, $8, NULL)`,
        values: [
            req.body.item_name, //HTML
            req.body.category,
            req.body.description, 
            req.body.rental_rate, 
            req.body.replacement_cost,
            imageUrl,
            req.body.quantity,
            req.session.user_id
        ]
    }

    client.query(`SET SCHEMA 'public'`)
    client.query(sqlQuery, (error, result) => {
        if(error){
            console.log(error)
            res.send(error)
        }
        else if(!error){            

            if(result.rows[0].is_verified == 0){ // DATABASE RETURNS vinventory_id NULL 
                return res.send('Conflict Query')
            }

            else if(vitem_id != null){ // IF ACCOUNT DOES EXIST
                return res.send('Success!')
            }
        }
    })
})