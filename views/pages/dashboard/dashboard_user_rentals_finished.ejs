<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<link rel="stylesheet" href="/assets/dashboard_orders.css">
	<title>Order Page</title>

  <style>
    .card {
    position: relative;
    display: flex;
    flex-direction: column;
    min-width: 0;
    padding: 20px;
    width: 450px;
    word-wrap: break-word;
    background-color: #fff;
    background-clip: border-box;
    border-radius: 6px;
    -moz-box-shadow: 0px 0px 5px 0px rgba(212, 182, 212, 1)
}

.comment-box{
    
    padding:5px;
}



.comment-area textarea{
   resize: none; 
        border: 1px solid #ad9f9f;
}


.form-control:focus {
    color: #495057;
    background-color: #fff;
    border-color: #ffffff;
    outline: 0;
    box-shadow: 0 0 0 1px rgb(255, 0, 0) !important;
}

.send {
    color: #fff;
    background-color: #ff0000;
    border-color: #ff0000;
}

.send:hover {
    color: #fff;
    background-color: #f50202;
    border-color: #f50202;
}


.rating {
 display: flex;
        margin-top: -10px;
    flex-direction: row-reverse;
    margin-left: -4px;
        float: left;
}

.rating>input {
    display: none
}

.rating>label {
        position: relative;
    width: 19px;
    font-size: 25px;
    color: #ff0000;
    cursor: pointer;
}

.rating>label::before {
    content: "\2605";
    position: absolute;
    opacity: 0
}

.rating>label:hover:before,
.rating>label:hover~label:before {
    opacity: 1 !important
}

.rating>input:checked~label:before {
    opacity: 1
}

.rating:hover>input:checked~label:before {
    opacity: 0.4
}
  </style>
</head>
<body>
	<!-- SIDEBAR -->
    <%- include ('dashboard_sidebar') -%>
    
	<section id="content">
		<nav>
			<i class='bx bx-menu toggle-sidebar' ></i>
			<form action="#">
				<div class="form-group">
				</div>
			</form>
			
		</nav>
    <div id="liveAlertPlaceholder" style="text-align: center; margin-top: 3px;"></div>
		<div class="dash-content">
            <div class="overview">
                <div class="title">
			<h1 class="title">Your Finished Rentals</h1>
			</div>
		<div class="boxes"  style="overflow-x:auto;">
      <% if(result.length == 0) { %>
        <h2 style="text-align:center">You have no finished rentals</h2>
      <% }else if(result) { %>

            <table class="table table-bordered">
                <thead>
                  <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Owner</th>
                    <th scope="col">Item Name</th>
                    <th scope="col">Rental Date</th>
                    <th scope="col">Return Date</th>
                    <th scope="col">Quantity</th>
                    <th scope="col">Total Amount</th>
                    <th scope="col">Reviews</th>
                  </tr>
                </thead>
                <tbody>
                  <% result.forEach(function(rental){ %>
                    <tr>
                      <td id="id"><%= rental.reservation_id %> <br> <a href="/rental/view/<%= rental.reservation_id %>">View Rental Details</a> </td>
                      <td id="owner"><%= rental.owner_id %></td>
                      <td id="itemName"> <a href="/items/view/<%= rental.item_id%>"><%= rental.item_name %></a></td>
                      <td id="rentalDate"><%= rental.reservation_start.toDateString() %></td>
                      <td id="returnDate"><%= rental.reservation_end.toDateString() %></td>
                      <td id="qty"><%= rental.quantity %></td>
                      <td id="totalAmount"><%= rental.total_amount %></td>
                      <td id="reviews"><div class="p-1">                        
                        <% if(rental.rating_id == null) { %>
                          <button class="btn btn-primary button-1" data-bs-toggle="modal" data-bs-target="#commentModal" id="buttonVal" value="1" data-id="1" onclick="commentFunc(<%= rental.item_id %>, <%= rental.reservation_id %>, <%= rental.owner_id %>)">Rate the Experiece</button><br>
                        <% } else{ %>
                          <span>You have finished rating this item</span>
                        <% } %>
                      </div></td>                      
                    </tr>
                  <% }) %>  
                </tbody>
              </table>
		</div>
	</section>

  <% } %>

  <!-- MODAL -->
  <form action="/dashboard/user/rentals/finished/addRating" method="post">
    <div class="modal fade" id="commentModal" tabindex="-1" aria-labelledby="commentModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="commentModalLabel">Review</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="card" style="width: 100%; padding-left: 100px;">               
              <div class="row">        
                  <div class="col-10">          
                      <div class="comment-box ml-2">              
                          <h4>Add a comment</h4>  <br>
                          <h6>Leave a Review!</h6>            
                          <div class="rating"> 
                              <input type="radio" name="rating" value="5" id="5" required><label for="5" >☆</label>
                              <input type="radio" name="rating" value="4" id="4"><label for="4" >☆</label> 
                              <input type="radio" name="rating" value="3" id="3"><label for="3" >☆</label>
                              <input type="radio" name="rating" value="2" id="2"><label for="2" >☆</label>
                              <input type="radio" name="rating" value="1" id="1"><label for="1" >☆</label>
                          </div>              
                          <div class="comment-area">                  
                              <textarea name="comment" class="form-control" placeholder="Leave a Comment" rows="4" required></textarea>              
                          </div>  
                          <input type="hidden" id="itemId" name="itemId" value="">   
                          <input type="hidden" id="reservationId" name="reservationId" value="">
                          <input type="hidden" id="ownerId" name="ownerId" value="">                                    
                      </div>
                  </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Submit Review</button>
          </div>
        </div>
      </div>
    </div>      
  </form>

	<script src="/assets/scripts/dashboard_orders.js"></script>
</body>

<script>
   async function getStatus(){   
    var status = '<%=status%>'

    if(status == 'ratingAdded'){
      const alertPlaceholder = document.getElementById('liveAlertPlaceholder')    
      const wrapper = document.createElement('div')
      wrapper.innerHTML = [
        `<div class="alert alert-success alert-dismissible" role="alert">`,
        `   <div>Rating Added Successfully</div>`,
        '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
        '</div>'
      ].join('')

      alertPlaceholder.append(wrapper)   
    }
  }  
  getStatus()

  function commentFunc(num1, num2, num3){
        itemId = document.getElementById("itemId")
        itemId.setAttribute("value", num1);     
        
        reservationId = document.getElementById("reservationId")
        reservationId.setAttribute("value", num2);
        
        ownerId = document.getElementById("ownerId")
        ownerId.setAttribute("value", num3);
    }
</script>
</html>